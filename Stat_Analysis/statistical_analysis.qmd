---
title: "Habitat_Model_VZH"
format: html
---

# Load packages 
```{r}
#clear R environment
rm(list = ls())

# check for a package, install and load 
pkgCheck <- function(x){ 
  if (!require(x,character.only = TRUE)){
    install.packages(x,dependencies=TRUE)
    if(!require(x,character.only = TRUE)) {
      stop()
    }
  }
}

pkgCheck("raster")
pkgCheck("spsurvey")
pkgCheck("terra")
pkgCheck("raster")
pkgCheck("ggplot2")
pkgCheck("tibble")
pkgCheck("readr")
pkgCheck("dplyr")
pkgCheck("tidyr")
pkgCheck("scales")
```

# Load Data 
```{r}
# load data 
brt <- read_delim("Stat_Analysis/stat_analysis_data/regr_analysis_brt.csv")
brt_add <- read_delim("Stat_Analysis/stat_analysis_data/regr_analysis_brt_add.csv")
rf <- read_delim("Stat_Analysis/stat_analysis_data/regr_analysis_rf.csv")
rf_add <- read_delim("Stat_Analysis/stat_analysis_data/regr_analysis_rf_add.csv")
hsc <- read_delim("Stat_Analysis/stat_analysis_data/hsc_regr_analysis.csv")
```
       
# Regr. Analysis
## BRT normal
### Predictor: Velocity
```{r}
### BRT models ----------------------------------------------------------------
# with k_index as response
regr_v_brt_k <- lm(m2_k_index_v ~ obs_k_index, data = brt)
sum_v_brt_k <- summary(regr_v_brt_k)
p_v_brt_k <- sum_v_brt_k$coefficients["obs_k_index", "Pr(>|t|)"]
s_v_brt_k <- sum_v_brt_k$coefficients["obs_k_index", "Estimate"]
r_v_brt_k <- summary(lm(m2_k_index_v ~ obs_k_index, data = brt))$adj.r.squared

# with shannon index as response
regr_v_brt_s <- lm(m2_shannon_v ~ obs_shannon, data = brt)
sum_v_brt_s <- summary(regr_v_brt_s)
p_v_brt_s <- sum_v_brt_s$coefficients["obs_shannon", "Pr(>|t|)"]
s_v_brt_s <- sum_v_brt_s$coefficients["obs_shannon", "Estimate"]
r_v_brt_s <- summary(lm(m2_shannon_v ~ obs_shannon, data = brt))$adj.r.squared

# with abundance as response
regr_v_brt_a <- lm(m2_abundance_v ~ obs_abundance, data = brt)
sum_v_brt_a <- summary(regr_v_brt_a)
p_v_brt_a <- sum_v_brt_a$coefficients["obs_abundance", "Pr(>|t|)"]
s_v_brt_a <- sum_v_brt_a$coefficients["obs_abundance", "Estimate"]
r_v_brt_a <- summary(lm(m2_abundance_v ~ obs_abundance, data = brt))$adj.r.squared

# with rel_abundance as response
regr_v_brt_ra <- lm(m2_rel_abundance_v ~ obs_rel_abundance, data = brt)
sum_v_brt_ra <- summary(regr_v_brt_ra)
p_v_brt_ra <- sum_v_brt_ra$coefficients["obs_rel_abundance", "Pr(>|t|)"]
s_v_brt_ra <- sum_v_brt_ra$coefficients["obs_rel_abundance", "Estimate"]
r_v_brt_ra <- summary(lm(m2_rel_abundance_v ~ obs_rel_abundance, data = brt))$adj.r.squared

```

### Predictor: V + WD
```{r}
### BRT models ----------------------------------------------------------------
# with k_index as response
regr_wd_brt_k <- lm(m2_k_index_wd ~ obs_k_index, data = brt)
sum_wd_brt_k <- summary(regr_wd_brt_k)
p_wd_brt_k <- sum_wd_brt_k$coefficients["obs_k_index", "Pr(>|t|)"]
s_wd_brt_k <- sum_wd_brt_k$coefficients["obs_k_index", "Estimate"]
r_wd_brt_k <- summary(lm(m2_k_index_wd ~ obs_k_index, data = brt))$adj.r.squared

# with shannon index as response
regr_wd_brt_s <- lm(m2_shannon_wd ~ obs_shannon, data = brt)
sum_wd_brt_s <- summary(regr_wd_brt_s)
p_wd_brt_s <- sum_wd_brt_s$coefficients["obs_shannon", "Pr(>|t|)"]
s_wd_brt_s <- sum_wd_brt_s$coefficients["obs_shannon", "Estimate"]
r_wd_brt_s <- summary(lm(m2_shannon_wd ~ obs_shannon, data = brt))$adj.r.squared

# with abundance as response
regr_wd_brt_a <- lm(m2_abundance_wd ~ obs_abundance, data = brt)
sum_wd_brt_a <- summary(regr_wd_brt_a)
p_wd_brt_a <- sum_wd_brt_a$coefficients["obs_abundance", "Pr(>|t|)"]
s_wd_brt_a <- sum_wd_brt_a$coefficients["obs_abundance", "Estimate"]
r_wd_brt_a <- summary(lm(m2_abundance_wd ~ obs_abundance, data = brt))$adj.r.squared

# with rel_abundance as response
regr_wd_brt_ra <- lm(m2_rel_abundance_wd ~ obs_rel_abundance, data = brt)
sum_wd_brt_ra <- summary(regr_wd_brt_ra)
p_wd_brt_ra <- sum_wd_brt_ra$coefficients["obs_rel_abundance", "Pr(>|t|)"]
s_wd_brt_ra <- sum_wd_brt_ra$coefficients["obs_rel_abundance", "Estimate"]
r_wd_brt_ra <- summary(lm(m2_rel_abundance_wd ~ obs_rel_abundance, data = brt))$adj.r.squared
```

## RF normal
### Predictor: Velocity
```{r}
### BRT models ----------------------------------------------------------------
# with k_index as response
regr_v_rf_k <- lm(m2_k_index_v ~ obs_k_index, data = rf)
sum_v_rf_k <- summary(regr_v_rf_k)
p_v_rf_k <- sum_v_rf_k$coefficients["obs_k_index", "Pr(>|t|)"]
s_v_rf_k <- sum_v_rf_k$coefficients["obs_k_index", "Estimate"]
r_v_rf_k <- summary(lm(m2_k_index_v ~ obs_k_index, data = rf))$adj.r.squared

# with shannon index as response
regr_v_rf_s <- lm(m2_shannon_v ~ obs_shannon, data = rf)
sum_v_rf_s <- summary(regr_v_rf_s)
p_v_rf_s <- sum_v_rf_s$coefficients["obs_shannon", "Pr(>|t|)"]
s_v_rf_s <- sum_v_rf_s$coefficients["obs_shannon", "Estimate"]
r_v_rf_s <- summary(lm(m2_shannon_v ~ obs_shannon, data = rf))$adj.r.squared

# with abundance as response
regr_v_rf_a <- lm(m2_abundance_v ~ obs_abundance, data = rf)
sum_v_rf_a <- summary(regr_v_rf_a)
p_v_rf_a <- sum_v_rf_a$coefficients["obs_abundance", "Pr(>|t|)"]
s_v_rf_a <- sum_v_rf_a$coefficients["obs_abundance", "Estimate"]
r_v_rf_a <- summary(lm(m2_abundance_v ~ obs_abundance, data = rf))$adj.r.squared

# with rel_abundance as response
regr_v_rf_ra <- lm(m2_rel_abundance_v ~ obs_rel_abundance, data = rf)
sum_v_rf_ra <- summary(regr_v_rf_ra)
p_v_rf_ra <- sum_v_rf_ra$coefficients["obs_rel_abundance", "Pr(>|t|)"]
s_v_rf_ra <- sum_v_rf_ra$coefficients["obs_rel_abundance", "Estimate"]
r_v_rf_ra <- summary(lm(m2_rel_abundance_v ~ obs_rel_abundance, data = rf))$adj.r.squared
```

### Predictor: V + WD
```{r}
### BRT models ----------------------------------------------------------------
# with k_index as response
regr_wd_rf_k <- lm(m2_k_index_wd ~ obs_k_index, data = rf)
sum_wd_rf_k <- summary(regr_wd_rf_k)
p_wd_rf_k <- sum_wd_rf_k$coefficients["obs_k_index", "Pr(>|t|)"]
s_wd_rf_k <- sum_wd_rf_k$coefficients["obs_k_index", "Estimate"]

# with shannon index as response
regr_wd_rf_s <- lm(m2_shannon_wd ~ obs_shannon, data = rf)
sum_wd_rf_s <- summary(regr_wd_rf_s)
p_wd_rf_s <- sum_wd_rf_s$coefficients["obs_shannon", "Pr(>|t|)"]
s_wd_rf_s <- sum_wd_rf_s$coefficients["obs_shannon", "Estimate"]

# with abundance as response
regr_wd_rf_a <- lm(m2_abundance_wd ~ obs_abundance, data = rf)
sum_wd_rf_a <- summary(regr_wd_rf_a)
p_wd_rf_a <- sum_wd_rf_a$coefficients["obs_abundance", "Pr(>|t|)"]
s_wd_rf_a <- sum_wd_rf_a$coefficients["obs_abundance", "Estimate"]

# with rel_abundance as response
regr_wd_rf_ra <- lm(m2_rel_abundance_wd ~ obs_rel_abundance, data = rf)
sum_wd_rf_ra <- summary(regr_wd_rf_ra)
p_wd_rf_ra <- sum_wd_rf_ra$coefficients["obs_rel_abundance", "Pr(>|t|)"]
s_wd_rf_ra <- sum_wd_rf_ra$coefficients["obs_rel_abundance", "Estimate"]
```

## HSC
### Predictor: FOEN class
```{r}
### BRT models ----------------------------------------------------------------
# with k_index as response
regr_foen_class_k <- lm(foen_class ~ k_index, data = hsc)
sum_foen_class_k <- summary(regr_foen_class_k)
p_foen_class_k <- sum_foen_class_k$coefficients["k_index", "Pr(>|t|)"]
s_foen_class_k <- sum_foen_class_k$coefficients["k_index", "Estimate"]

# with shannon index as response
regr_foen_class_s <- lm(foen_class ~ shannon, data = hsc)
sum_foen_class_s <- summary(regr_foen_class_s)
p_foen_class_s <- sum_foen_class_s$coefficients["shannon", "Pr(>|t|)"]
s_foen_class_s <- sum_foen_class_s$coefficients["shannon", "Estimate"]

# with abundance as response
regr_foen_class_a <- lm(foen_class ~ abundance, data = hsc)
sum_foen_class_a <- summary(regr_foen_class_a)
p_foen_class_a <- sum_foen_class_a$coefficients["abundance", "Pr(>|t|)"]
s_foen_class_a <- sum_foen_class_a$coefficients["abundance", "Estimate"]

# with rel_abundance as response
regr_foen_class_ra <- lm(foen_class ~ rel_abundance, data = hsc)
sum_foen_class_ra <- summary(regr_foen_class_ra)
p_foen_class_ra <- sum_foen_class_ra$coefficients["rel_abundance", "Pr(>|t|)"]
s_foen_class_ra <- sum_foen_class_ra$coefficients["rel_abundance", "Estimate"]
```

### Predictor: FOEN HSI
```{r}
### BRT models ----------------------------------------------------------------
# with k_index as response
regr_foen_hsi_k <- lm(foen_hsi ~ k_index, data = hsc)
sum_foen_hsi_k <- summary(regr_foen_hsi_k)
p_foen_hsi_k <- sum_foen_hsi_k$coefficients["k_index", "Pr(>|t|)"]
s_foen_hsi_k <- sum_foen_hsi_k$coefficients["k_index", "Estimate"]

# with shannon index as response
regr_foen_hsi_s <- lm(foen_hsi ~ shannon, data = hsc)
sum_foen_hsi_s <- summary(regr_foen_hsi_s)
p_foen_hsi_s <- sum_foen_hsi_s$coefficients["shannon", "Pr(>|t|)"]
s_foen_hsi_s <- sum_foen_hsi_s$coefficients["shannon", "Estimate"]

# with abundance as response
regr_foen_hsi_a <- lm(foen_hsi ~ abundance, data = hsc)
sum_foen_hsi_a <- summary(regr_foen_hsi_a)
p_foen_hsi_a <- sum_foen_hsi_a$coefficients["abundance", "Pr(>|t|)"]
s_foen_hsi_a <- sum_foen_hsi_a$coefficients["abundance", "Estimate"]

# with rel_abundance as response
regr_foen_hsi_ra <- lm(foen_hsi ~ rel_abundance, data = hsc)
sum_foen_hsi_ra <- summary(regr_foen_hsi_ra)
p_foen_hsi_ra <- sum_foen_hsi_ra$coefficients["rel_abundance", "Pr(>|t|)"]
s_foen_hsi_ra <- sum_foen_hsi_ra$coefficients["rel_abundance", "Estimate"]
```

```{r}
plot(foen_hsi ~ rel_abundance, data = hsc)
abline(lm(foen_hsi ~ rel_abundance, data = hsc))
```

## Stat. Analysis
```{r}
# Modellvoraussetzungen prüfen - residualplot 
par(mfrow=c(2, 2))

### BRT normal ### -----------------------------------------------------------
### Predictor Velocity ###
plot(regr_v_brt_k) # Linearität ok; Residuen ok 
plot(regr_v_brt_s) # Linearität ok; Residuen evt. nicht normalverteilt 
plot(regr_v_brt_a) # Linearität nicht gegeben (umgekehrte Trichterform); Residuen evt. nicht normalverteilt
plot(regr_v_brt_ra) # Linearität nicht gegeben (umgekehrte Trichterform); Residuen evt. nicht normalverteilt

### Predictor V + WD ###
plot(regr_wd_brt_k) # Linearität ok; Residuen evt. nicht normalverteilt
plot(regr_wd_brt_s) # Linearität ok; Residuen evt. nicht normalverteilt
plot(regr_wd_brt_a) # Linearität nicht gegeben (umgekehrte Trichterform); Residuen nicht normalverteilt
plot(regr_wd_brt_ra) # Linearität nicht gegeben (umgekehrte Trichterform); Residuen nicht normalverteilt

### BRT add ### ---------------------------------------------------------------
### Predictor Velocity ###
plot(regr_v_brt_k_add) # Linearität ok; Residuen ok
plot(regr_v_brt_s_add) # Linearität nicht gegeben (leichte Bananenform); Residuen nicht normalverteilt
plot(regr_v_brt_a_add) # Linearität ok; Residuen normalverteilt
plot(regr_v_brt_ra_add) # Linearität ok; Residuen normalverteilt 

### Predictor V + WD ###
plot(regr_wd_brt_k_add) # Linearität ok; Residuen nicht normalverteilt
plot(regr_wd_brt_s_add) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_wd_brt_a_add) # Linearität ok; Residuen normalverteilt
plot(regr_wd_brt_ra_add) # Linearität nicht gegeben (umgekehrte Trichterform); Residen normalverteilt 

### RF normal ### ---------------------------------------------------------------
### Predictor Velocity ###
plot(regr_v_rf_k) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_v_rf_s) # Linearität ok; Residuen nicht normalverteilt
plot(regr_v_rf_a) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_v_rf_ra) # Linearität ok; Residuen nicht normalverteilt 

### Predictor V + WD ###
plot(regr_wd_rf_k) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_wd_rf_s) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_wd_rf_a) # Linearität ok; Residuen normalverteilt 
plot(regr_wd_rf_ra) # Linearität ok; Residuen normalverteilt 

### RF add ### ---------------------------------------------------------------
### Predictor Velocity ###
plot(regr_v_rf_k_add) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_v_rf_s_add) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_v_rf_a_add) # Linearität ok; Residuen nicht normalverteilt
plot(regr_v_rf_ra_add) # Linearität ok; Residuen normalverteilt

### Predictor V + WD ###
plot(regr_wd_rf_k_add) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_wd_rf_s_add) # Linearität ok; Residuen nicht normalverteilt 
plot(regr_wd_rf_a_add) # Linearität nicht gegeben (umgekehrte Trichterform); Residuen normalverteilt 
plot(regr_wd_rf_ra_add) # Linearität nicht gegeben (umgekehrte Trichterform); Residuen nicht normalverteilt 

### HSC model ### ---------------------------------------------------------------
### Predictor FOEN class ###
plot(regr_foen_class_k) # Linearität nicht gegeben (Bananenform); Residuen nicht normalverteilt
plot(regr_foen_class_s) # Linearität nicht gegeben; Residuen nicht normalverteilt
plot(regr_foen_class_a) # Linearität nicht gegeben; Residuen nicht normalverteilt
plot(regr_foen_class_ra) # Linearität nicht gegeben; Residuen nicht normalverteilt

### Predictor FOEN HSI ###
plot(regr_foen_hsi_k) # Linearität nicht gegeben; Residuen nicht normalverteilt
plot(regr_foen_hsi_s) # Linearität nicht gegeben; Residuen nicht normalverteilt
plot(regr_foen_hsi_a) # Linearität nicht gegeben; Residuen nicht normalverteilt
plot(regr_foen_hsi_ra) # Linearität nicht gegeben; Residuen nicht normalverteilt
```

# Plots
## BRT normal 
### Predictor: Velocity
```{r}
# with k_index as response ----------------------------------------------------
p_brt_k <- ggplot(brt, aes(obs_k_index, m2_k_index_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_brt_wrap_k <- ggplot(brt, aes(obs_k_index, m2_k_index_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_k.png", plot = p_brt_k, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wrap_k.png", plot = p_brt_wrap_k, width = 8, height = 8)

# with shannon index as response ----------------------------------------------
p_brt_s <- ggplot(brt, aes(obs_shannon, m2_shannon_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))
  
p_brt_wrap_s <- ggplot(brt, aes(obs_shannon, m2_shannon_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_s.png", plot = p_brt_s, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wrap_s.png", plot = p_brt_wrap_s, width = 8, height = 8)

# with abundance as response --------------------------------------------------
p_brt_a <- ggplot(brt, aes(obs_abundance, m2_abundance_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_brt_wrap_a <- ggplot(brt, aes(obs_abundance, m2_abundance_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_a.png", plot = p_brt_a, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wrap_a.png", plot = p_brt_wrap_a, width = 8, height = 8)

# with relative abundance as response -----------------------------------------
p_brt_ra <- ggplot(brt, aes(obs_rel_abundance, m2_rel_abundance_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_brt_wrap_ra <- ggplot(brt, aes(obs_rel_abundance, m2_rel_abundance_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_ra.png", plot = p_brt_ra, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wrap_ra.png", plot = p_brt_wrap_ra, width = 8, height = 8)
```

### Predictor: V + WD
```{r}
# with k_index as response-----------------------------------------------------
p_brt_wd_k <- ggplot(brt, aes(obs_k_index, m2_k_index_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_brt_wd_wrap_k <- ggplot(brt, aes(obs_k_index, m2_k_index_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_k.png", plot = p_brt_wd_k, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_wrap_k.png", plot = p_brt_wd_wrap_k, width = 8, height = 8)

# with shannon index as response ---------------------------------------------
p_brt_wd_s <- ggplot(brt, aes(obs_shannon, m2_shannon_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

  
p_brt_wd_wrap_s <- ggplot(brt, aes(obs_shannon, m2_shannon_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_s.png", plot = p_brt_wd_s, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_wrap_s.png", plot = p_brt_wd_wrap_s, width = 8, height = 8)

# with abundance as response --------------------------------------------------
p_brt_wd_a <- ggplot(brt, aes(obs_abundance, m2_abundance_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

  
p_brt_wd_wrap_a <- ggplot(brt, aes(obs_abundance, m2_abundance_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_a.png", plot = p_brt_wd_a, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_wrap_a.png", plot = p_brt_wd_wrap_a, width = 8, height = 8)

# with relative abundance as response ----------------------------------------
p_brt_wd_ra <- ggplot(brt, aes(obs_rel_abundance, m2_rel_abundance_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

  
p_brt_wd_wrap_ra <- ggplot(brt, aes(obs_rel_abundance, m2_rel_abundance_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_ra.png", plot = p_brt_wd_ra, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_brt_wd_wrap_ra.png", plot = p_brt_wd_wrap_ra, width = 8, height = 8)
```

## RF normal 
### Predictor: Velocity
```{r}
# with k_index as response ----------------------------------------------------
p_rf_k <- ggplot(rf, aes(obs_k_index, m2_k_index_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_rf_wrap_k <- ggplot(rf, aes(obs_k_index, m2_k_index_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_k.png", plot = p_rf_k, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wrap_k.png", plot = p_rf_wrap_k, width = 8, height = 8)

# with shannon index as response ----------------------------------------------
p_rf_s <- ggplot(rf, aes(obs_shannon, m2_shannon_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))
  
p_rf_wrap_s <- ggplot(rf, aes(obs_shannon, m2_shannon_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_s.png", plot = p_rf_s, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wrap_s.png", plot = p_rf_wrap_s, width = 8, height = 8)

# with abundance as response --------------------------------------------------
p_rf_a <- ggplot(rf, aes(obs_abundance, m2_abundance_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_rf_wrap_a <- ggplot(rf, aes(obs_abundance, m2_abundance_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_a.png", plot = p_rf_a, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wrap_a.png", plot = p_rf_wrap_a, width = 8, height = 8)

# with relative abundance as response -----------------------------------------
p_rf_ra <- ggplot(rf, aes(obs_rel_abundance, m2_rel_abundance_v)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_rf_wrap_ra <- ggplot(rf, aes(obs_rel_abundance, m2_rel_abundance_v)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_ra.png", plot = p_rf_ra, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wrap_ra.png", plot = p_rf_wrap_ra, width = 8, height = 8)
```

### Predictor: V + WD
```{r}
# with k_index as response-----------------------------------------------------
p_rf_wd_k <- ggplot(rf, aes(obs_k_index, m2_k_index_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_rf_wd_wrap_k <- ggplot(rf, aes(obs_k_index, m2_k_index_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "K-Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_k.png", plot = p_rf_wd_k, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_wrap_k.png", plot = p_rf_wd_wrap_k, width = 8, height = 8)

# with shannon index as response ---------------------------------------------
p_rf_wd_s <- ggplot(rf, aes(obs_shannon, m2_shannon_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

  
p_rf_wd_wrap_s <- ggplot(rf, aes(obs_shannon, m2_shannon_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "Shannon Index Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_s.png", plot = p_rf_wd_s, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_wrap_s.png", plot = p_rf_wd_wrap_s, width = 8, height = 8)

# with abundance as response --------------------------------------------------
p_rf_wd_a <- ggplot(rf, aes(obs_abundance, m2_abundance_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

  
p_rf_wd_wrap_a <- ggplot(rf, aes(obs_abundance, m2_abundance_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 3772) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "Absolute Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))
# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_a.png", plot = p_rf_wd_a, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_wrap_a.png", plot = p_rf_wd_wrap_a, width = 8, height = 8)

# with relative abundance as response ----------------------------------------
p_rf_wd_ra <- ggplot(rf, aes(obs_rel_abundance, m2_rel_abundance_wd)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

  
p_rf_wd_wrap_ra <- ggplot(rf, aes(obs_rel_abundance, m2_rel_abundance_wd)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "Relative Abundance Predicted"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_ra.png", plot = p_rf_wd_ra, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_rf_wd_wrap_ra.png", plot = p_rf_wd_wrap_ra, width = 8, height = 8)
```

## HSC 
### Predictor: FOEN class
```{r}
# with k_index as response ----------------------------------------------------
p_class_k <- ggplot(hsc, aes(k_index, foen_class)) +
  geom_point() +
  geom_abline(slope = 5/1.0, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_class_wrap_k <- ggplot(hsc, aes(k_index, foen_class)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 5/1.0, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_class_k.png", plot = p_class_k, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_class_wrap_k.png", plot = p_class_wrap_k, width = 8, height = 8)

# with shannon index as response ----------------------------------------------
p_class_s <- ggplot(hsc, aes(shannon, foen_class)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))
  
p_class_wrap_s <- ggplot(hsc, aes(shannon, foen_class)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_class_s.png", plot = p_class_s, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_class_wrap_s.png", plot = p_class_wrap_s, width = 8, height = 8)

# with abundance as response --------------------------------------------------
p_class_a <- ggplot(hsc, aes(abundance, foen_class)) +
  geom_point() +
  geom_abline(slope = 5/3772, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_class_wrap_a <- ggplot(hsc, aes(abundance, foen_class)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 5/3772, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_class_a.png", plot = p_class_a, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_class_wrap_a.png", plot = p_class_wrap_a, width = 8, height = 8)

# with relative abundance as response -----------------------------------------
p_class_ra <- ggplot(hsc, aes(rel_abundance, foen_class)) +
  geom_point() +
  geom_abline(slope = 5/1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_class_wrap_ra <- ggplot(hsc, aes(rel_abundance, foen_class)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 5/1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 5.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "FOEN Class"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_class_ra.png", plot = p_class_ra, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_class_wrap_ra.png", plot = p_class_wrap_ra, width = 8, height = 8)
```

### Predictor: FOEN HSI
```{r}
# with k_index as response ----------------------------------------------------
p_hsi_k <- ggplot(hsc, aes(k_index, foen_hsi)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_hsi_wrap_k <- ggplot(hsc, aes(k_index, foen_hsi)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "K-Index Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_hsi_k.png", plot = p_hsi_k, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_hsi_wrap_k.png", plot = p_hsi_wrap_k, width = 8, height = 8)

# with shannon index as response ----------------------------------------------
p_hsi_s <- ggplot(hsc, aes(shannon, foen_hsi)) +
  geom_point() +
  geom_abline(slope = 1/5, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))
  
p_hsi_wrap_s <- ggplot(hsc, aes(shannon, foen_hsi)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1/5, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 5.0) + 
  labs(
    x = "Shannon Index Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_hsi_s.png", plot = p_hsi_s, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_hsi_wrap_s.png", plot = p_hsi_wrap_s, width = 8, height = 8)

# with abundance as response --------------------------------------------------
p_hsi_a <- ggplot(hsc, aes(abundance, foen_hsi)) +
  geom_point() +
  geom_abline(slope = 1/3772, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_hsi_wrap_a <- ggplot(hsc, aes(abundance, foen_hsi)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1/3772, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 3772) + 
  labs(
    x = "Absolute Abundance Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_hsi_a.png", plot = p_hsi_a, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_hsi_wrap_a.png", plot = p_hsi_wrap_a, width = 8, height = 8)

# with relative abundance as response -----------------------------------------
p_hsi_ra <- ggplot(hsc, aes(rel_abundance, foen_hsi)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=12),
        axis.title = element_text(size=14))

p_hsi_wrap_ra <- ggplot(hsc, aes(rel_abundance, foen_hsi)) +
  facet_wrap(~Reach_Untersuchungsstelle) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, lty = 2, lwd = 0.8) +
  stat_smooth(method = "lm", se = FALSE, fullrange = TRUE, lwd = 0.8, col = "black") +
  theme_minimal() +
  ylim(0, 1.0) +
  xlim(0, 1.0) + 
  labs(
    x = "Relative Abundance Observed",
    y = "FOEN HSI"
  ) +
  theme_minimal() +
  theme(axis.text = element_text(size=8),
        axis.title = element_text(size=12),
        strip.text.x = element_text(
        size = 12))

# save the plots 
ggsave("Stat_Analysis/regr_plots/regr_hsi_ra.png", plot = p_hsi_ra, width = 6, height = 5)
ggsave("Stat_Analysis/regr_plots/regr_hsi_wrap_ra.png", plot = p_hsi_wrap_ra, width = 8, height = 8)
```

# Create dataframe
```{r}
results_hdm <- data.frame(lm_p_value = c(p_v_brt_k, p_v_brt_s, p_v_brt_a, p_v_brt_ra, p_v_brt_k_add, p_v_brt_s_add, p_v_brt_a_add, p_v_brt_ra_add, p_v_rf_k, p_v_rf_s, p_v_rf_a, p_v_rf_ra, p_v_rf_k_add, p_v_rf_s_add, p_v_rf_a_add, p_v_rf_ra_add, 
                                           p_wd_brt_k, p_wd_brt_s, p_wd_brt_a, p_wd_brt_ra, p_wd_brt_k_add, p_wd_brt_s_add, p_wd_brt_a_add, p_wd_brt_ra_add, p_wd_rf_k, p_wd_rf_s, p_wd_rf_a, p_wd_rf_ra, p_wd_rf_k_add, p_wd_rf_s_add, p_wd_rf_a_add, p_wd_rf_ra_add,
                                           p_foen_class_k, p_foen_class_s, p_foen_class_a, p_foen_class_ra,
                                           p_foen_hsi_k, p_foen_hsi_s, p_foen_hsi_a, p_foen_hsi_ra),
                          
                          lm_slope = c(s_v_brt_k, s_v_brt_s, s_v_brt_a, s_v_brt_ra, s_v_brt_k_add, s_v_brt_s_add, s_v_brt_a_add, s_v_brt_ra_add, s_v_rf_k, s_v_rf_s, s_v_rf_a, s_v_rf_ra, s_v_rf_k_add, s_v_rf_s_add, s_v_rf_a_add, s_v_rf_ra_add,
                                       s_wd_brt_k, s_wd_brt_s, s_wd_brt_a, s_wd_brt_ra, s_wd_brt_k_add, s_wd_brt_s_add, s_wd_brt_a_add, s_wd_brt_ra_add, s_wd_rf_k, s_wd_rf_s, s_wd_rf_a, s_wd_rf_ra, s_wd_rf_k_add, s_wd_rf_s_add, s_wd_rf_a_add, s_wd_rf_ra_add,
                                       s_foen_class_k, s_foen_class_s, s_foen_class_a, s_foen_class_ra,
                                       s_foen_hsi_k, s_foen_hsi_s, s_foen_hsi_a, s_foen_hsi_ra),
                          
                          index = c("k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", 
                                    "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance", "k_index", "shannon", "abundance", "rel_abundance"),
                          
  
           variable = c("velocity", "velocity", "velocity", "velocity", "velocity + add", "velocity + add", "velocity + add", "velocity + add",
                        "velocity", "velocity", "velocity", "velocity", "velocity + add", "velocity + add", "velocity + add", "velocity + add",
                        "v + wd", "v + wd", "v + wd", "v + wd", "v + wd + add", "v + wd + add", "v + wd + add", "v + wd + add",
                        "v + wd", "v + wd", "v + wd", "v + wd", "v + wd + add", "v + wd + add", "v + wd + add", "v + wd + add", 
                        "foen class", "foen class", "foen class", "foen class",
                        "foen hsi", "foen hsi", "foen hsi", "foen hsi"),
           
           model = c("brt", "brt", "brt", "brt", "brt", "brt", "brt", "brt",
                     "rf", "rf", "rf", "rf", "rf", "rf", "rf", "rf",
                     "brt", "brt", "brt", "brt", "brt", "brt", "brt", "brt",
                     "rf", "rf", "rf", "rf", "rf", "rf", "rf", "rf",
                     "hsc", "hsc", "hsc", "hsc", "hsc", "hsc", "hsc", "hsc"))

# write .csv file 
write.csv(results_hdm, "Stat_Analysis/results_regr_analysis.csv", row.names = FALSE)
```                 
                           


```{r}
# Select only rows, which contain significant p-values and sort them
selected_rows <- results_hdm[results_hdm$lm_p_value < 0.05, ]
sorted_data <- selected_rows[order(selected_rows$lm_p_value), ]

# exclude hsc model data, because the slope is negative 
data <- subset(sorted_data, model != "hsc")
```

```{r}
selected_rows <- results_hdm[results_hdm$lm_slope, ]
sorted_slope <- selected_rows[order(selected_rows$lm_slope), ]

data <- subset(sorted_slope, model != "hsc")
```


