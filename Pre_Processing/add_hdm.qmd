---
title: "add_hdm"
format: html
---

# Libraries
```{r}
#clear R environment
rm(list = ls())

# check for a package, install and load 
pkgCheck <- function(x){ 
  if (!require(x,character.only = TRUE)){
    install.packages(x,dependencies=TRUE)
    if(!require(x,character.only = TRUE)) {
      stop()
    }
  }
}

pkgCheck("sf")
pkgCheck("terra")
pkgCheck("dplyr")
pkgCheck("data.table")  # fast data.frame manipulation (used by mlr3)
pkgCheck("readr")
pkgCheck("sp")
pkgCheck("raster")
pkgCheck("Metrics")
pkgCheck("tidyr")

# load self-written functions 
source("mth_functions.R")
```

# Write Rasters with added Parameters
create separate function to mask each attribute for each discharge 
```{r}
#biogeo_new <- c("Southern Alps" = 0, "Central Plateau" = 1, "Northern Alps" = 2, "Eastern Central Alps" = 3)

### GL1 ### --------------------------------------------------------------
GL1_2_56_ezg <- hdm_add(shp_path = "Pre_Processing/raster_files/GL1_shape.shp", 
                   z = 708.2711667, 
                   ecomorph_class = 2, 
                   nitrogen = 4.43, 
                   phosphor = 0.398984998, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/GL1_z_2_56_ezg.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/GL1_ecomorph_2_56_ezg.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/GL1_nitrogen_2_56_ezg.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/GL1_phosphor_2_56_ezg.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/GL1_biogeo_2_56_ezg.tif",
               q_path = "Pre_Processing/raster_files/GL1_v_2_56_ezg.tif")

GL1_3_28 <- hdm_add(shp_path = "Pre_Processing/raster_files/GL1_shape.shp", 
                   z = 708.2711667, 
                   ecomorph_class = 2, 
                   nitrogen = 4.43, 
                   phosphor = 0.398984998, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/GL1_z_3_28.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/GL1_ecomorph_3_28.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/GL1_nitrogen_3_28.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/GL1_phosphor_3_28.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/GL1_biogeo_3_28.tif",
               q_path = "Pre_Processing/raster_files/GL1_v_3_28.tif")

GL1_6_00 <- hdm_add(shp_path = "Pre_Processing/raster_files/GL1_shape.shp", 
                   z = 708.2711667, 
                   ecomorph_class = 2, 
                   nitrogen = 4.43, 
                   phosphor = 0.398984998, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/GL1_z_6_00.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/GL1_ecomorph_6_00.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/GL1_nitrogen_6_00.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/GL1_phosphor_6_00.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/GL1_biogeo_6_00.tif",
               q_path = "Pre_Processing/raster_files/GL1_v_6_00.tif")

GL1_9_00 <- hdm_add(shp_path = "Pre_Processing/raster_files/GL1_shape.shp", 
                   z = 708.2711667, 
                   ecomorph_class = 2, 
                   nitrogen = 4.43, 
                   phosphor = 0.398984998, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/GL1_z_9_00.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/GL1_ecomorph_9_00.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/GL1_nitrogen_9_00.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/GL1_phosphor_9_00.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/GL1_biogeo_9_00.tif",
               q_path = "Pre_Processing/raster_files/GL1_v_9_00.tif")

GL1_12_68 <- hdm_add(shp_path = "Pre_Processing/raster_files/GL1_shape.shp", 
                   z = 708.2711667, 
                   ecomorph_class = 2, 
                   nitrogen = 4.43, 
                   phosphor = 0.398984998, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/GL1_z_12_68.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/GL1_ecomorph_12_68.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/GL1_nitrogen_12_68.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/GL1_phosphor_12_68.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/GL1_biogeo_12_68.tif",
               q_path = "Pre_Processing/raster_files/GL1_v_12_68.tif")

GL1_12_68_v <- raster("Pre_Processing/raster_files/GL1_v_12_68.tif")
GL1_12_68_wd <- raster("Pre_Processing/raster_files/GL1_wd_12_68.tif")

GL1_16_00_v <- raster("Pre_Processing/raster_files/GL1_v_16_00.tif")
GL1_16_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_16_00.tif")

GL1_19_00_v <- raster("Pre_Processing/raster_files/GL1_v_19_00.tif")
GL1_19_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_19_00.tif")

GL1_22_00_v <- raster("Pre_Processing/raster_files/GL1_v_22_00.tif")
GL1_22_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_22_00.tif")

GL1_25_00_v <- raster("Pre_Processing/raster_files/GL1_v_25_00.tif")
GL1_25_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_25_00.tif")

GL1_28_00_v <- raster("Pre_Processing/raster_files/GL1_v_28_00.tif")
GL1_28_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_28_00.tif")

GL1_31_76_v <- raster("Pre_Processing/raster_files/GL1_v_31_76.tif")
GL1_31_76_wd <- raster("Pre_Processing/raster_files/GL1_wd_31_76.tif")
```


```{r}
### GL2 ### --------------------------------------------------------------
GL2 <- hdm_add(shp_path = "Pre_Processing/raster_files/GL2_shape.shp", 
                   z = 738.0426667, 
                   ecomorph_class = 2, 
                   nitrogen = 4.35, 
                   phosphor = 0.4049904, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/GL2_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/GL2_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/GL2_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/GL2_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/GL2_biogeo.tif")

### L2 ### --------------------------------------------------------------
L2 <- hdm_add(shp_path = "Pre_Processing/raster_files/L2_shape.shp", 
                   z = 794.6173333, 
                   ecomorph_class = 2, 
                   nitrogen = 4.03, 
                   phosphor = 0.347871958, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/L2_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/L2_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/L2_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/L2_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/L2_biogeo.tif")

### M1 ### --------------------------------------------------------------
M1 <- hdm_add(shp_path = "Pre_Processing/raster_files/M1_shape.shp", 
                   z = 403.4363333, 
                   ecomorph_class = 2, 
                   nitrogen = 6.12, 
                   phosphor = 0.453213924, 
                   biogeo = 0, 
                   raster_z_path = "Pre_Processing/raster_files/M1_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/M1_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/M1_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/M1_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/M1_biogeo.tif")

### S1 ### --------------------------------------------------------------
S1 <- hdm_add(shp_path = "Pre_Processing/raster_files/S1_shape.shp", 
                   z = 585.8313333, 
                   ecomorph_class = 2, 
                   nitrogen = 11.17, 
                   phosphor = 1.352706565, 
                   biogeo = 2, 
                   raster_z_path = "Pre_Processing/raster_files/S1_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/S1_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/S1_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/S1_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/S1_biogeo.tif")

### S2 ### --------------------------------------------------------------
S2 <- hdm_add(shp_path = "Pre_Processing/raster_files/S2_shape.shp", 
                   z = 562.59975, 
                   ecomorph_class = 2, 
                   nitrogen = 11.29, 
                   phosphor = 1.293177637, 
                   biogeo = 1, 
                   raster_z_path = "Pre_Processing/raster_files/S2_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/S2_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/S2_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/S2_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/S2_biogeo.tif")

### TH4 ### --------------------------------------------------------------
TH4 <- hdm_add(shp_path = "Pre_Processing/raster_files/TH4_shape.shp", 
                   z = 540.3599167, 
                   ecomorph_class = 0, 
                   nitrogen = 11.4, 
                   phosphor = 1.503643677, 
                   biogeo = 1, 
                   raster_z_path = "Pre_Processing/raster_files/TH4_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/TH4_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/TH4_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/TH4_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/TH4_biogeo.tif")

### VR3 ### --------------------------------------------------------------
VR3 <- hdm_add(shp_path = "Pre_Processing/raster_files/VR3_shape.shp", 
                   z = 671.8723333, 
                   ecomorph_class = 1, 
                   nitrogen = 5.0, 
                   phosphor = 0.676068382, 
                   biogeo = 3, 
                   raster_z_path = "Pre_Processing/raster_files/VR3_z.tif",
                   raster_ecomorph_path = "Pre_Processing/raster_files/VR3_ecomorph.tif",
                   raster_nitrogen_path = "Pre_Processing/raster_files/VR3_nitrogen.tif",
                   raster_phosphor_path = "Pre_Processing/raster_files/VR3_phosphor.tif",
                   raster_biogeo_path = "Pre_Processing/raster_files/VR3_biogeo.tif")
```

# Make stacks for each Q
## Read all rasters
```{r}
### GL1 ### ----------------------------------------------------------------
GL1_z <- raster("Pre_Processing/raster_files/GL1_z.tif")
GL1_ecomorph <- raster("Pre_Processing/raster_files/GL1_ecomorph.tif")
GL1_nitrogen <- raster("Pre_Processing/raster_files/GL1_nitrogen.tif")
GL1_phosphor <- raster("Pre_Processing/raster_files/GL1_phosphor.tif")
GL1_biogeo <- raster("Pre_Processing/raster_files/GL1_biogeo.tif")

GL1_2_56_ezg_v <- raster("Pre_Processing/raster_files/GL1_v_2_56_ezg.tif")
GL1_2_56_ezg_wd <- raster("Pre_Processing/raster_files/GL1_wd_2_56_ezg.tif")

GL1_3_28_v <- raster("Pre_Processing/raster_files/GL1_v_3_28.tif")
GL1_3_28_wd <- raster("Pre_Processing/raster_files/GL1_wd_3_28.tif")

GL1_6_00_v <- raster("Pre_Processing/raster_files/GL1_v_6_00.tif")
GL1_6_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_6_00.tif")

GL1_9_00_v <- raster("Pre_Processing/raster_files/GL1_v_9_00.tif")
GL1_9_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_9_00.tif")

GL1_12_68_v <- raster("Pre_Processing/raster_files/GL1_v_12_68.tif")
GL1_12_68_wd <- raster("Pre_Processing/raster_files/GL1_wd_12_68.tif")

GL1_16_00_v <- raster("Pre_Processing/raster_files/GL1_v_16_00.tif")
GL1_16_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_16_00.tif")

GL1_19_00_v <- raster("Pre_Processing/raster_files/GL1_v_19_00.tif")
GL1_19_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_19_00.tif")

GL1_22_00_v <- raster("Pre_Processing/raster_files/GL1_v_22_00.tif")
GL1_22_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_22_00.tif")

GL1_25_00_v <- raster("Pre_Processing/raster_files/GL1_v_25_00.tif")
GL1_25_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_25_00.tif")

GL1_28_00_v <- raster("Pre_Processing/raster_files/GL1_v_28_00.tif")
GL1_28_00_wd <- raster("Pre_Processing/raster_files/GL1_wd_28_00.tif")

GL1_31_76_v <- raster("Pre_Processing/raster_files/GL1_v_31_76.tif")
GL1_31_76_wd <- raster("Pre_Processing/raster_files/GL1_wd_31_76.tif")
```


## Stack all rasters
```{r}
GL1_2_56_ezg <- stack(GL1_2_56_ezg_v, GL1_2_56_ezg_wd, GL1_z, GL1_ecomorph, GL1_nitrogen, GL1_phosphor, GL1_biogeo) 
names(GL1_2_56_ezg) <- c("velocity", "wd_m", "z", "ecomorph_class", "diff_nitrogen", "diff_phosphor", "biogeo_int") 

writeRaster(GL1_2_56_ezg, "Pre_Processing/rasters_stacked/GL1_2_56_ezg_var.grd", overwrite = TRUE)
```

